添加根据输入关键字返回班车路线或站点信息的接口任务：

流程图大致如下：

![服务流程图](C:\Users\yangelhu\Downloads\未命名文件.png)

客户端发送请求经过域名解析到达TGW网关部分，然后将请求流转给内部网关Sparta进行服务域名解析，请求到达服务节点（MobileHttpServer）。服务与服务之间通过JCE协议进行通信。

1.在服务节点添加BusQuery查询接口，获取从上游服务流转过来的前端请求数据。若要获取公交站点信息，还需要依赖下游网关服务。根据提供的jce协议，将请求数据封装进对应的结构体中，然后通过RPC调用获取下游返回的结果，提取有效结果并将结果返回给客户端。





请求url：[http://maphttpbeta.sparta.html5.qq.com/mobilemap?mmtype=busquery&wd=%E8%BF%90%E9%80%9A&py=39984099&px=116307493&rn=20&rp=1&imei=865575034638051&device=iOS12.2%20&uip=117.188.8.125&app_ver=6.9.0.434&type=2&cb=_ip8](http://maphttpbeta.sparta.html5.qq.com/mobilemap?mmtype=busquery&wd=运通&py=39984099&px=116307493&rn=20&rp=1&imei=865575034638051&device=iOS12.2 &uip=117.188.8.125&app_ver=6.9.0.434&type=2&cb=_ip8)



mmtype决定处理函数。wd是输入的关键字，px表示经度，py表示纬度，rn表示条数，rp表示页数。

type=1表示返回路线信息，type=2表示返回站点信息。





##### H5用户反馈后端服务

为客户端增加Unread字段用来检测更新状态。

ticket/info的请求中，502错误的原因----读取配置文件出现异常状态，未配置相关属性的配置文件。

关于Unread字段，用来表示用户是否查看当前处理进展。数据回传时候更新，用户点击查看后置为默认值。



**2019.07.31**

针对TPAD回传处理状态时的处理状态和话术码不同步问题，在需要补充信息时用户体验时后端无法准确校验的问题，后端检测-1时默认判断 描述文字和手机号码是必须项。

处理进展回调时增加对手图话术码的校验，不合格的校验码打回重新认证

为管理平台添加URL字段，重构了返回值结构体，增加了URL字段。



##### 2019.08.02

管理平台---可以显示所有工单信息，增加拦截功能禁止转发流转至第三方的工单任务。更新历史信息，更新当前状态和处理方。

兼容管理平台前端tag/list接口，传id和name均可查询到标签信息，id=0时返回一级标签信息，可以根据parent_id和parent_name查询二级标签的值，其中name支持多标签查询，id目前只支持单标签查询。

修复之前未判断从第三方流转回来的请求响应信息，该问题会导致第三方未成功接收工单而后端默认将工单已转给第三方处理而客户端这边一直处于正在处理的现象。

在工单详情中增加补充的照片，文字描述，电话等信息。





2019.08.07

1.int64数据传至后端发现数据精度不足，js解析时处理精度不够，造成数据获取错误，无法获取到工单详情信息。已解决。

2.兼容qimei字段，数据库中增加该字段。

3.管理平台无法根据手机型号和处理人获取工单状态，原因是为添加相关字段在sql语句中。已解决。

4.修改流转状态bug，使流转回来的工单可以转至tapd平台。